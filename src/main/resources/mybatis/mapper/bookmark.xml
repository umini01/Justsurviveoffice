<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="bookmark">

    <!-- 북마크 추가 -->
    <insert id="addBookmark">
	INSERT INTO BOOKMARK (
	    BOOKMARKNO, FK_ID, FK_BOARDNO, CREATEDATMARK
	) VALUES (
	    BOOKMARK_SEQ.NEXTVAL,
	    #{fk_id},
	    #{fk_boardNo},
	    SYSDATE
	)
	</insert>

    <!-- 북마크 삭제 -->
    <delete id="removeBookmark" parameterType="map">
        DELETE FROM bookmark
        WHERE fk_id = #{fk_id}
          AND fk_boardno = #{fk_boardNo}
    </delete>

	<!-- 게시물과 관련된 모든 북마크 삭제 -->
    <delete id="removeAllBookmark" parameterType="Long">
        DELETE FROM bookmark
        WHERE fk_boardno = #{fk_boardNo}
    </delete>
    
    <!-- 북마크 여부 체크 -->
    <select id="checkBookmark" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM bookmark
        WHERE fk_id = #{fk_id}
          AND fk_boardno = #{fk_boardNo}
    </select>

    <!-- 북마크 목록 조회 -->
    <select id="getUserBookmarks" parameterType="string"
            resultType="com.spring.app.bookmark.domain.BookMarkDTO">
        SELECT
            bm.bookmarkno       AS bookmarkNo,
            bm.fk_id            AS fk_id,
            bm.fk_boardno       AS fk_boardNo,  <!-- ✅ alias 꼭 설정 -->
            bm.createdatmark     AS createdAtMark,
            b.board_title       AS boardName
            b.fk_categoryno     AS fk_categoryNo
        FROM bookmark bm
        JOIN board b
          ON bm.fk_boardno = b.board_no
        WHERE bm.fk_id = #{fk_id}
        ORDER BY bm.createdatmark DESC
    </select>
    
    
    <!-- 마이페이지 북마크 스크롤 -->
    <select id="bookmarkScroll" parameterType="map" resultType="com.spring.app.bookmark.domain.BookMarkDTO">
	    SELECT 
	        bm.bookmarkno     AS bookmarkNo,
	        bm.fk_id          AS fk_id,
	        bm.fk_boardno     AS fk_boardNo,
	        bm.createdatmark  AS createdAtMark,
	        b.boardname       AS boardName,
	        b.boardcontent    AS boardContent,
	        b.fk_categoryno   AS fk_categoryNo,
	        b.createdatboard  AS createdAtBoard
	    FROM bookmark bm JOIN board b 
	    ON bm.fk_boardNo = b.boardNo
	    WHERE bm.fk_id = #{id}
	    ORDER BY bm.createdAtMark DESC
	    OFFSET #{start,jdbcType=INTEGER} ROWS
	    FETCH NEXT #{len,jdbcType=INTEGER} ROWS ONLY
	</select>
    
    
</mapper>